import Foundation

class SupplementMapper {
    static let shared = SupplementMapper()

    private init() {}

    private let nameMap: [String: String] = [
        // MARK: - ë£¨í…Œì¸ ê´€ë ¨
        "ë£¨í…Œì¸": "ë§ˆë¦¬ê³¨ë“œê½ƒì¶”ì¶œë¬¼",
        "ë‹¥í„°ë£¨í…Œì¸": "ë£¨í…Œì¸",
        "ëˆˆê±´ê°•": "ë§ˆë¦¬ê³¨ë“œê½ƒì¶”ì¶œë¬¼",

        // MARK: - ë¹„íƒ€ë¯¼C ê´€ë ¨
        "ë¹„íƒ€ë¯¼c": "ë¹„íƒ€ë¯¼ C",
        "ë¹„íƒ€ë¯¼ ì”¨": "ë¹„íƒ€ë¯¼ C",
        "ë¹„íƒ€c": "ë¹„íƒ€ë¯¼ C",
        "vitamin c": "ë¹„íƒ€ë¯¼ C",

        // MARK: - ë¹„íƒ€ë¯¼D ê´€ë ¨
        "ë¹„íƒ€ë¯¼d": "ë¹„íƒ€ë¯¼ D",
        "ë¹„íƒ€d": "ë¹„íƒ€ë¯¼ D",
        "vitamin d": "ë¹„íƒ€ë¯¼ D",
        "í–‡ë¹›ë¹„íƒ€ë¯¼": "ë¹„íƒ€ë¯¼ D",

        // MARK: - ì˜¤ë©”ê°€-3 ê´€ë ¨
        "ì˜¤ë©”ê°€3": "ì˜¤ë©”ê°€-3 ì§€ë°©ì‚°",
        "ì˜¤ë©”ê°€-3": "ì˜¤ë©”ê°€-3 ì§€ë°©ì‚°",
        "í”¼ì‰¬ì˜¤ì¼": "ì˜¤ë©”ê°€-3 ì§€ë°©ì‚°",
        "fish oil": "ì˜¤ë©”ê°€-3 ì§€ë°©ì‚°",
        "epa dha": "ì˜¤ë©”ê°€-3 ì§€ë°©ì‚°",

        // MARK: - ë°€í¬ì‹œìŠ¬ ê´€ë ¨
        "ë°€í¬ì”¨ìŠ¬": "ë°€í¬ì‹œìŠ¬",
        "ê°„ì˜ì–‘ì œ": "ë°€í¬ì‹œìŠ¬",
        "ë°€í¬ì‹œìŠ¬": "ë°€í¬ì‹œìŠ¬",

        // MARK: - ì½œë¼ê² ê´€ë ¨
        "ì½œë¼ê²": "ì½œë¼ê² ë³´ì¶©ì œ",
        "í”¼ì‰¬ì½œë¼ê²": "ì½œë¼ê² ë³´ì¶©ì œ",
        "marine collagen": "ì½œë¼ê² ë³´ì¶©ì œ",

        // MARK: - ì² ë¶„ ê´€ë ¨
        "ì² ë¶„": "ì² ë¶„ê³¼ ì—½ì‚°",
        "ì² ë¶„ì œ": "ì² ë¶„ê³¼ ì—½ì‚°",
        "ì—½ì‚°": "ì² ë¶„ê³¼ ì—½ì‚°",
        "ì„ì‚°ë¶€ì˜ì–‘ì œ": "ì² ë¶„ê³¼ ì—½ì‚°",

        // MARK: - ë¹„ì˜¤í‹´ ê´€ë ¨
        "ë¹„ì˜¤í‹´": "ë¹„ì˜¤í‹´(ë¹„íƒ€ë¯¼ B7)",
        "íƒˆëª¨ì˜ì–‘ì œ": "ë¹„ì˜¤í‹´(ë¹„íƒ€ë¯¼ B7)",

        // MARK: - ìœ ì‚°ê·  ê´€ë ¨
        "ìœ ì‚°ê· ": "í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤",
        "í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤": "í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤",
        "ì¥ì˜ì–‘ì œ": "í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤",

        // MARK: - ì¢…í•©ë¹„íƒ€ë¯¼
        "ë©€í‹°ë¹„íƒ€ë¯¼": "ë©€í‹°ë¹„íƒ€ë¯¼",
        "ì¢…í•©ë¹„íƒ€ë¯¼": "ë©€í‹°ë¹„íƒ€ë¯¼",
        "ë¹„íƒ€ë¯¼ì¢…í•©ì œ": "ë©€í‹°ë¹„íƒ€ë¯¼",

        // MARK: - í•­ì‚°í™”
        "ì½”ì—”ìì„q10": "ì½”ì—”ìì„ Q10",
        "ì½”íí…": "ì½”ì—”ìì„ Q10",
        "q10": "ì½”ì—”ìì„ Q10",

        // MARK: - ì•ŒíŒŒë¦¬í¬ì‚°
        "ì•ŒíŒŒë¦¬í¬ì‚°": "ì•ŒíŒŒ ë¦¬í¬ì‚°",
        "alpha lipoic acid": "ì•ŒíŒŒ ë¦¬í¬ì‚°",

        // MARK: - ë§ˆê·¸ë„¤ìŠ˜
        "ë§ˆê·¸ë„¤ìŠ˜": "ë§ˆê·¸ë„¤ìŠ˜",
        "ê·¼ìœ¡ê²½ë ¨": "ë§ˆê·¸ë„¤ìŠ˜",
        "magnesium": "ë§ˆê·¸ë„¤ìŠ˜",

        // MARK: - ì•„ì—°
        "ì•„ì—°": "ì•„ì—°",
        "ë©´ì—­ì˜ì–‘ì œ": "ì•„ì—°",
        "zinc": "ì•„ì—°"
    ]

    /// ì‚¬ìš©ì ì…ë ¥ì„ APIìš© ì›ì¬ë£Œëª…ìœ¼ë¡œ ë§¤í•‘
    func mapToIngredient(_ productName: String) -> String {
        var current = productName.trimmingCharacters(in: .whitespacesAndNewlines).lowercased()
        var visited = Set<String>()

        while let mapped = nameMap[current], !visited.contains(mapped.lowercased()) {
            visited.insert(current)
            current = mapped.lowercased()
        }

        print("ğŸ” ì‚¬ìš©ì ì…ë ¥: \(productName) â†’ ìµœì¢… ë§¤í•‘ ê²°ê³¼: \(current)")
        return current
    }
}
